<html>
<head>
    <style>
        body {
            background-color: black;
            text-align: center;
        }
        #pongCanvas {
            background-color: black;
            border: solid #00FF00;
            top: 6.25%;
        }
        h1 {
            color: #00FF00;
            font-family: sans-serif;
        }
        p {
            color: white;
        }
    </style>
    <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.2.3.min.js"></script>
    </head>
    <body>
        <h1>PONG Revised!!</h1>
    <canvas id="pongCanvas" width="800" height="500">
    Your browser does not support the HTML5 canvas.
    </canvas>
        
        
    <script>
        window.onload = function(){
            var canvas = document.getElementById("pongCanvas");
        
            if (canvas && canvas.getContext) {
                var ctx = canvas.getContext("2d");
            }
        
            document.onkeydown = function(e) {
                switch (e.keyCode) {
                    case 37:
//                      alert('left');
                        break;
                    case 38:
//                      alert('up');
                        paddle1y -= 10;
                        break;
                    case 39:
//                      alert('right');
                        break;
                    case 40:
                        paddle1y += 10;
//                      alert('down');
                        break;
                }
            };

            var mousePos = null; 
            var mousePosNew = null;
            var message =  null;

            function getMousePos(canvas, evt) {
                var rect = canvas.getBoundingClientRect();
                return {
                    x: Math.round((evt.clientX-rect.left)/(rect.right-rect.left)*canvasWidth),
                    y: Math.round((evt.clientY-rect.top)/(rect.bottom-rect.top)*canvasHeight)
                };
            }

            canvas.addEventListener('mousemove', function(evt) {
                mousePos = getMousePos(canvas, evt);
                message = 'Mouse position: ' + mousePos.x + ',' + mousePos.y;
            }, false);

            var canvasHeight = ctx.canvas.height;
            var canvasWidth = ctx.canvas.width; 
        
            var ballx = 400;
            var bally = 250;
        
            var y = 1;
            var x = 1;
        
            var paddle1x = 10;
            var paddle1y = 25;
            var paddle1Length = 50;
            var paddle1Width = 10;
        
            //STUB variables
            var ballVelocity = 3;
            var ballAngle = Math.floor(Math.random() * 360) + 1;
//          document.writeln(ballAngle);
        
        
//          ctx.strokeStyle = "#00FF00";
//          ctx.fillStyle = "#00FF00";
//          ctx.lineWidth = 5;
//          ctx.beginPath();
//          ctx.arc(ballx, bally, 8, 0, 2*Math.PI);
//          ctx.fill();
//          ctx.stroke(); 
        
            var tick = 1;
        
        
            function draw(){
            
                //clearing the screen
                ctx.fillStyle = "black";
                ctx.fillRect(0, 0, 100000, 10000);
            
                //drawing the top wall
                ctx.strokeStyle = "#00FF00";
                ctx.fillStyle = "#00FF00";
                ctx.lineWidth = 5;
                ctx.beginPath();
                ctx.fillRect(0, 0, canvasWidth, 20);
            
                //drawing the bottom wall
                ctx.strokeStyle = "#00FF00";
                ctx.fillStyle = "#00FF00";
                ctx.lineWidth = 5;
                ctx.beginPath();
                ctx.fillRect(0, canvasHeight-20, canvasWidth, 20);
            
                //drawing the middle lines
                for(var i=0; i < 500; i = i + 20){
                    ctx.strokeStyle = "#green";
                    ctx.fillStyle = "#green";
                    ctx.lineWidth = 5;
                    ctx.beginPath();
                    ctx.fillRect(400, i, 1, 10);
                }
            
                //drawing the ball.
                ctx.strokeStyle = "#00FF00";
                ctx.fillStyle = "#00FF00";
                ctx.lineWidth = 5;
                ctx.beginPath();
                ctx.arc(ballx, bally, 4, 0, 2*Math.PI);
                ctx.fill();
                ctx.stroke(); 
            
            
                //drawing paddle1
                ctx.strokeStyle = "#00FF00";
                ctx.fillStyle = "#00FF00";
                ctx.lineWidth = 5;
                ctx.beginPath();
                ctx.fillRect(paddle1x, paddle1y, paddle1Width, paddle1Length);
            
                //write the mouse positio on the canvas
                ctx.font = '18pt Calibri';
                ctx.fillStyle = '#00FF00';
                ctx.fillText(message, 300,50);
            
                //drawing paddle2
            }
        
            function game(){
                if (mousePos != null){
                    if (mousePosNew != mousePos){
                        paddle1y = mousePos.y;
                        mousePosNew =mousePos;
                    }
                }

//              document.writeln("game is being called");
                if((ballx <= 0) || (ballx >= 800)){
//                  alert("ball hit x boundaries");
                    reflectBallx();
                }
            
                if((bally <= 20) || (bally >= 480)){
//                  alert("ball hit y boundaries");
                    reflectBally();
                
                }
            
                //ball detection with paddle
                if(ballx <= (paddle1x + paddle1Width) && (bally >= paddle1y && bally <= (paddle1y + paddle1Length))){
                    reflectBallx();
//                  alert("ball touched");
                }

                //make sure paddle doesn't go off the screen
                if (paddle1y < paddle1Length/2) {
                    paddle1y = paddle1Length/2;                
                } 

                if (paddle1y>canvasHeight- paddle1Length - paddle1Length/2){
                    paddle1y = canvasHeight- paddle1Length - paddle1Length/2;
                }
            
                changeBallx();
                changeBally();
            
                draw();

                ++tick;
                if (tick == 500){
            	   tick = 1;
            	   console.log("ballx: " + ballx + " ; bally: " + bally);
                }
            
            }
        
            function changeBallx(){
                ballx = ballx + (x * ballVelocity * Math.cos(ballAngle));
//              document.writeln("ballx = " + ballx);
            }
        
            function changeBally(){
                bally = bally + (y * ballVelocity * Math.sin(ballAngle));
//              document.writeln("bally = " + bally);
            }
        
            function reflectBallx(){
                x = x * -1;
            }
        
            function reflectBally(){
                y = y * -1
            }
        
            setInterval(game, 5);
        }


/* ----------------------SOCKET.IO----------------------------- */         
        

        var socket = io();
                
        // test connection to server
        socket.on('test', function(msg) {
            console.log(msg);
        });
    </script>  
    </body>
</html>